name: Boat Race Ultimate Split (36 Matrix)

on:
  workflow_dispatch:

jobs:
  collect:
    name: ${{ matrix.name }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        # 1年分を「上旬・中旬・下旬」の36個に分割して、確実に6時間以内に終わらせる
        include:
          # 1月
          - { name: "Jan-01-10", s: "2025-01-01", e: "2025-01-10" }
          - { name: "Jan-11-20", s: "2025-01-11", e: "2025-01-20" }
          - { name: "Jan-21-31", s: "2025-01-21", e: "2025-01-31" }
          # 2月
          - { name: "Feb-01-10", s: "2025-02-01", e: "2025-02-10" }
          - { name: "Feb-11-20", s: "2025-02-11", e: "2025-02-20" }
          - { name: "Feb-21-28", s: "2025-02-21", e: "2025-02-28" }
          # 3月
          - { name: "Mar-01-10", s: "2025-03-01", e: "2025-03-10" }
          - { name: "Mar-11-20", s: "2025-03-11", e: "2025-03-20" }
          - { name: "Mar-21-31", s: "2025-03-21", e: "2025-03-31" }
          # 4月
          - { name: "Apr-01-10", s: "2025-04-01", e: "2025-04-10" }
          - { name: "Apr-11-20", s: "2025-04-11", e: "2025-04-20" }
          - { name: "Apr-21-30", s: "2025-04-21", e: "2025-04-30" }
          # 5月
          - { name: "May-01-10", s: "2025-05-01", e: "2025-05-10" }
          - { name: "May-11-20", s: "2025-05-11", e: "2025-05-20" }
          - { name: "May-21-31", s: "2025-05-21", e: "2025-05-31" }
          # 6月
          - { name: "Jun-01-10", s: "2025-06-01", e: "2025-06-10" }
          - { name: "Jun-11-20", s: "2025-06-11", e: "2025-06-20" }
          - { name: "Jun-21-30", s: "2025-06-21", e: "2025-06-30" }
          # 7月
          - { name: "Jul-01-10", s: "2025-07-01", e: "2025-07-10" }
          - { name: "Jul-11-20", s: "2025-07-11", e: "2025-07-20" }
          - { name: "Jul-21-31", s: "2025-07-21", e: "2025-07-31" }
          # 8月
          - { name: "Aug-01-10", s: "2025-08-01", e: "2025-08-10" }
          - { name: "Aug-11-20", s: "2025-08-11", e: "2025-08-20" }
          - { name: "Aug-21-31", s: "2025-08-21", e: "2025-08-31" }
          # 9月
          - { name: "Sep-01-10", s: "2025-09-01", e: "2025-09-10" }
          - { name: "Sep-11-20", s: "2025-09-11", e: "2025-09-20" }
          - { name: "Sep-21-30", s: "2025-09-21", e: "2025-09-30" }
          # 10月
          - { name: "Oct-01-10", s: "2025-10-01", e: "2025-10-10" }
          - { name: "Oct-11-20", s: "2025-10-11", e: "2025-10-20" }
          - { name: "Oct-21-31", s: "2025-10-21", e: "2025-10-31" }
          # 11月
          - { name: "Nov-01-10", s: "2025-11-01", e: "2025-11-10" }
          - { name: "Nov-11-20", s: "2025-11-11", e: "2025-11-20" }
          - { name: "Nov-21-30", s: "2025-11-21", e: "2025-11-30" }
          # 12月
          - { name: "Dec-01-10", s: "2025-12-01", e: "2025-12-10" }
          - { name: "Dec-11-20", s: "2025-12-11", e: "2025-12-20" }
          - { name: "Dec-21-31", s: "2025-12-21", e: "2025-12-31" }

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install pandas requests beautifulsoup4

      - name: データ収集 (10日分)
        # 並列数を8のまま、期間を短くして確実にクリアする
        run: python -u collector.py --start ${{ matrix.s }} --end ${{ matrix.e }}

      - name: 成果物アップロード
        uses: actions/upload-artifact@v4
        with:
          name: data-${{ matrix.name }}
          path: data/*.csv
